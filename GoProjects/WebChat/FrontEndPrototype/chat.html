<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<title>Вебчат</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body onload="ask_data()">
    <script>
    function ask_data()
    {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function()
        {
            if( xhttp.readyState == 4 )
            {
                // Получили ответ
                if( xhttp.status != 200 )
                {
                    alert( "Ошибка HTTP:" + xhttp.status )
                    return
                }

                message = xhttp.responseText;
                if( message != "~~~~~" )
                {
                    document.getElementById( "received" ).value += message
                }

                // Запрашиваем данные снова, спустя определённое время
                window.setTimeout( ask_data, 100 )
            }
        };

        xhttp.open( "GET", "data", true );
        xhttp.send();
    }

    function send_message_prototype()
    {
        message = document.getElementById( "to_send" ).value
        if( !message )
        {
            return
        }

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function()
        {
            if( xhttp.readyState == 4 )
            {
                // Получили ответ
                document.getElementById( "to_send" ).value = ""
                if( xhttp.status != 200 )
                {
                    alert( "Ошибка HTTP:" + xhttp.status )
                }
            }
        };

        xhttp.open( "POST", "msg", true )
        xhttp.setRequestHeader( "Content-type", "text/plain" )
        xhttp.setRequestHeader( "Content-Length", message.length )
        xhttp.send( message )
    }
    </script>

	<p>
        <textarea id="received" name="rcv_data" cols="120" rows="20" readonly="true"></textarea>
        <textarea name="online_list" readonly="true"></textarea>
    </p>
	<p><textarea id="to_send" name="snd_data" cols="120" rows="5"></textarea>
        <button type="button" onclick="send_message_prototype()">Отправить сообщение</button>
    </p>
</body>
</html>
